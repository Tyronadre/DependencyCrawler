package data.dataImpl;

import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import data.Component;
import data.Vulnerability;
import data.VulnerabilityAffects;
import data.VulnerabilityReference;

import java.util.ArrayList;
import java.util.List;

public class VulnerabilityImpl implements Vulnerability {
    Component component;
    JsonObject data;
    List<VulnerabilityReference> vulnerabilityReferences;
    List<VulnerabilityAffects> vulerabilityAffects;

    public VulnerabilityImpl(Component component, JsonObject data) {
        this.component = component;
        this.data = data;
        this.vulnerabilityReferences = new ArrayList<>();
        for (JsonElement reference : data.get("references").getAsJsonArray()) {
            vulnerabilityReferences.add(new VulnerabilityReferenceImpl(reference.getAsJsonObject()));
        }
        this.vulerabilityAffects = new ArrayList<>();
        for (JsonElement affects : data.get("affected").getAsJsonArray()) {
            vulerabilityAffects.add(new VulnerabilityAffectsImpl(affects.getAsJsonObject()));
        }
    }

    @Override
    public Component getComponent() {
        return component;
    }

    @Override
    public String getId() {
        return data.get("id").getAsString();
    }

    @Override
    public String getSummary() {
        return data.get("summary").getAsString();
    }

    @Override
    public String getDetails() {
        return data.get("details").getAsString();
    }

    @Override
    public List<String> getAllAliases() {
        var l = new ArrayList<String>();
        for (var alias : data.get("aliases").getAsJsonArray()) {
            l.add(alias.getAsString());
        }
        return l;
    }

    @Override
    public String getModified() {
        return data.get("modified").getAsString();
    }

    @Override
    public String getPublished() {
        return data.get("published").getAsString();
    }

    @Override
    public String getSeverity() {
        return data.get("severity").getAsJsonArray().get(0).getAsJsonObject().get("score").getAsString();
    }

    @Override
    public List<VulnerabilityReference> getAllReferences() {
        return vulnerabilityReferences;
    }

    @Override
    public List<VulnerabilityAffects> getAllAffects() {
        return vulerabilityAffects;
    }
}
